# Analytical Dashboard

BI-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º—ã–º–∏ –¥–∞—à–±–æ—Ä–¥–∞–º–∏ –ø–æ –æ—Ç–¥–µ–ª–∞–º. MVP –≤–µ—Ä—Å–∏—è –≤–∫–ª—é—á–∞–µ—Ç –¥–∞—à–±–æ—Ä–¥ PM —Å –º–µ—Ç—Ä–∏–∫–∞–º–∏ –∏–∑ Pipedrive.

## üöÄ –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

- **Frontend/Backend**: Next.js 14 (App Router, TypeScript, React Server Components)
- **UI**: TailwindCSS + shadcn/ui
- **–ì—Ä–∞—Ñ–∏–∫–∏**: Recharts
- **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö**: PostgreSQL + Prisma ORM
- **–•–æ—Å—Ç–∏–Ω–≥**: Vercel
- **–ö—Ä–æ–Ω—ã**: Vercel Cron (–∫–∞–∂–¥—ã–µ 30 –º–∏–Ω—É—Ç)

## üìã –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å MVP

### –î–∞—à–±–æ—Ä–¥ PM (–ï–≤–≥–µ–Ω–∏—è –ü–æ–ø–æ–≤–∞)

**KPI-–∫–∞—Ä—Ç–æ—á–∫–∏:**
- –ó–∞–ø—É—Å–∫ –ø—Ä–æ–µ–∫—Ç–æ–≤, % (1 –∑–Ω–∞–∫ –ø–æ—Å–ª–µ –∑–∞–ø—è—Ç–æ–π)
- –°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è Integration‚ÜíPilot, –¥–Ω–∏ (1 –∑–Ω–∞–∫)
- –ü—Ä–æ—Ü–µ–Ω—Ç –ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã—Ö —Å—Ä–æ–∫–æ–≤, % (1 –∑–Ω–∞–∫)

**–í–∏–¥–∂–µ—Ç—ã:**
- –¢—Ä–µ–Ω–¥: –ó–∞–ø—É—Å–∫ –ø—Ä–æ–µ–∫—Ç–æ–≤, % –ø–æ –º–µ—Å—è—Ü–∞–º (MSK)
- –¢–∞–±–ª–∏—Ü–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏–π: —Å–¥–µ–ª–∫–∏ —Å –ø—Ä–æ—Å—Ä–æ—á–∫–æ–π

**–§–∏–ª—å—Ç—Ä—ã:**
- –ü–µ—Ä–∏–æ–¥: 01.01.2025 ‚Üí —Å–µ–≥–æ–¥–Ω—è (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
- –í–ª–∞–¥–µ–ª–µ—Ü: –ø—Ä–µ–¥–∑–∞–ø–æ–ª–Ω–µ–Ω–æ "–ï–≤–≥–µ–Ω–∏—è –ü–æ–ø–æ–≤–∞"

**–†–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º–∞—è —Å–µ—Ç–∫–∞:**
- Drag & drop / resize –≤–∏–¥–∂–µ—Ç–æ–≤
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –æ–±—â–µ–π —Ä–∞—Å–∫–ª–∞–¥–∫–∏ –≤ –ë–î

## üõ† –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

### 1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è

```bash
git clone <your-repo-url>
cd analytical-dashboard
```

### 2. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
npm install
```

### 3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env.local`:

```env
# Pipedrive API
PIPEDRIVE_API_TOKEN=your_pipedrive_api_token_here
PIPEDRIVE_BASE_URL=https://api.pipedrive.com/v1

# Sync security
SYNC_SECRET=your_sync_secret_here

# Database
DATABASE_URL=postgresql://username:password@localhost:5432/analytical_dashboard

# App settings
APP_TIMEZONE=Europe/Moscow
```

### 4. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

```bash
# –ì–µ–Ω–µ—Ä–∞—Ü–∏—è Prisma –∫–ª–∏–µ–Ω—Ç–∞
npm run db:generate

# –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü –≤ –ë–î
npm run db:push

# –ò–ª–∏ —Å –º–∏–≥—Ä–∞—Ü–∏—è–º–∏
npm run db:migrate
```

### 5. –ó–∞–ø—É—Å–∫ –≤ —Ä–µ–∂–∏–º–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

```bash
npm run dev
```

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ –ø–æ –∞–¥—Ä–µ—Å—É [http://localhost:3000](http://localhost:3000)

## üóÑ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### –û—Å–Ω–æ–≤–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã:

- `pd_users` - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ Pipedrive
- `pd_pipelines` - –ø–∞–π–ø–ª–∞–π–Ω—ã
- `pd_stages` - —ç—Ç–∞–ø—ã –ø–∞–π–ø–ª–∞–π–Ω–æ–≤
- `pd_deals` - —Å–¥–µ–ª–∫–∏
- `pd_stage_events` - –∏—Å—Ç–æ—Ä–∏—è –ø–µ—Ä–µ—Ö–æ–¥–æ–≤ –ø–æ —ç—Ç–∞–ø–∞–º
- `pm_metrics_cache` - –∫—ç—à –º–µ—Ç—Ä–∏–∫
- `dashboard_layouts` - —Ä–∞—Å–∫–ª–∞–¥–∫–∏ –¥–∞—à–±–æ—Ä–¥–æ–≤
- `sync_logs` - –ª–æ–≥–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏

## üîÑ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å Pipedrive

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è

–ö—Ä–æ–Ω-–∑–∞–¥–∞—á–∞ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∫–∞–∂–¥—ã–µ 30 –º–∏–Ω—É—Ç –∏ –≤—ã–ø–æ–ª–Ω—è–µ—Ç –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω—É—é —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é.

### –†—É—á–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è

```bash
# –ü–æ–ª–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è
curl -X POST "http://localhost:3000/api/sync/pipedrive?mode=full" \
  -H "Authorization: Bearer your_sync_secret"

# –ò–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è
curl -X POST "http://localhost:3000/api/sync/pipedrive?mode=inc" \
  -H "Authorization: Bearer your_sync_secret"
```

### –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –ø–∞–π–ø–ª–∞–π–Ω—ã –∏ —ç—Ç–∞–ø—ã

**Leads:**
- Lead ‚Üí Lead in progress

**Sales CIS:**
- E ‚Äì Recognize ‚Üí D ‚Äì Evaluate ‚Üí C ‚Äì Select ‚Üí B ‚Äì Negotiate ‚Üí A ‚Äì Purchase

**Clients CIS:**
- Integration ‚Üí Pilot ‚Üí Active ‚Üí Issued ‚Üí Dormant ‚Üí Lost

**Partner:**
- –•–æ—á—É! ‚Üí Potential ‚Üí Engaged ‚Üí Active ‚Üí Dormant

## üìä API Endpoints

### –ú–µ—Ç—Ä–∏–∫–∏ PM
```
GET /api/pm/metrics?from=2025-01-01&to=2025-12-31&ownerName=–ï–≤–≥–µ–Ω–∏—è%20–ü–æ–ø–æ–≤–∞
```

### –ü—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã–µ —Å–¥–µ–ª–∫–∏
```
GET /api/pm/overdue?from=2025-01-01&to=2025-12-31&ownerName=–ï–≤–≥–µ–Ω–∏—è%20–ü–æ–ø–æ–≤–∞
```

### –†–∞—Å–∫–ª–∞–¥–∫–∞ –¥–∞—à–±–æ—Ä–¥–∞
```
GET /api/dashboard-layouts/pm
PUT /api/dashboard-layouts/pm
```

### –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è
```
POST /api/sync/pipedrive?mode=full|inc
```

## üöÄ –î–µ–ø–ª–æ–π –Ω–∞ Vercel

### 1. –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è

1. –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π –ø—Ä–æ–µ–∫—Ç –≤ Vercel
2. –ü–æ–¥–∫–ª—é—á–∏—Ç–µ –≤–∞—à GitHub —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
3. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –≤ Vercel Dashboard

### 2. –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –≤ Vercel

–î–æ–±–∞–≤—å—Ç–µ –≤—Å–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏–∑ `.env.local` –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–æ–µ–∫—Ç–∞ Vercel:

- `PIPEDRIVE_API_TOKEN`
- `PIPEDRIVE_BASE_URL`
- `SYNC_SECRET`
- `DATABASE_URL`
- `APP_TIMEZONE`

### 3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Supabase –∏–ª–∏ Neon –¥–ª—è PostgreSQL:

1. –°–æ–∑–¥–∞–π—Ç–µ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
2. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Å—Ç—Ä–æ–∫—É –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –≤ `DATABASE_URL`
3. –í—ã–ø–æ–ª–Ω–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏–∏: `npm run db:push`

### 4. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫—Ä–æ–Ω-–∑–∞–¥–∞—á

–ö—Ä–æ–Ω-–∑–∞–¥–∞—á–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ `vercel.json`:

```json
{
  "crons": [
    {
      "path": "/api/sync/pipedrive?mode=inc",
      "schedule": "*/30 * * * *"
    }
  ]
}
```

## üîß –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞

### –ú–µ—Ç—Ä–∏–∫–∞ "–ó–∞–ø—É—Å–∫ –ø—Ä–æ–µ–∫—Ç–æ–≤"

- **–ü–æ–¥–ø–∏—Å–∞–Ω–Ω—ã–µ**: —Å–¥–µ–ª–∫–∏, –ø–µ—Ä–µ—à–µ–¥—à–∏–µ –∏–∑ Sales CIS: A ‚Äì Purchase –≤ Clients CIS: Integration
- **–ó–∞–ø—É—â–µ–Ω–Ω—ã–µ**: –∏–∑ –ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã—Ö, —Å–¥–µ–ª–∫–∏ –≤ Clients CIS: Active
- **–§–æ—Ä–º—É–ª–∞**: (LaunchedCount / SignedCount) √ó 100

### –ú–µ—Ç—Ä–∏–∫–∞ "–ü—Ä–æ–ø—É—â–µ–Ω–Ω—ã–µ —Å—Ä–æ–∫–∏"

- **–ü–ª–∞–Ω–æ–≤–∞—è –¥–∞—Ç–∞**: –ø–æ–ª–µ "–û–∂–∏–¥–∞–µ–º–∞—è –¥–∞—Ç–∞ –∑–∞–∫—Ä—ã—Ç–∏—è" –Ω–∞ –º–æ–º–µ–Ω—Ç –≤—Ö–æ–¥–∞ –≤ Sales CIS: E ‚Äì Recognize
- **–§–∞–∫—Ç –∑–∞–ø—É—Å–∫–∞**: –¥–∞—Ç–∞ –≤—Ö–æ–¥–∞ –≤ Clients CIS: Active
- **–ü—Ä–æ—Å—Ä–æ—á–∫–∞**: –µ—Å–ª–∏ fact_date > plan_date –∏–ª–∏ (–Ω–µ—Ç —Ñ–∞–∫—Ç–∞ –∏ today > plan_date)

### –ú–µ—Ç—Ä–∏–∫–∞ "–°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è Integration ‚Üí Pilot"

- **–†–∞—Å—á–µ—Ç**: —Å—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –º–µ–∂–¥—É –ø–µ—Ä–≤—ã–º –≤—Ö–æ–¥–æ–º –≤ Integration –∏ –ø–µ—Ä–≤—ã–º –≤—Ö–æ–¥–æ–º –≤ Pilot
- **–ï–¥–∏–Ω–∏—Ü–∞**: –∫–∞–ª–µ–Ω–¥–∞—Ä–Ω—ã–µ –¥–Ω–∏

## üé® –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
src/
‚îú‚îÄ‚îÄ app/                    # Next.js App Router
‚îÇ   ‚îú‚îÄ‚îÄ api/               # API endpoints
‚îÇ   ‚îú‚îÄ‚îÄ pm/                # PM dashboard page
‚îÇ   ‚îú‚îÄ‚îÄ globals.css        # Global styles
‚îÇ   ‚îî‚îÄ‚îÄ layout.tsx         # Root layout
‚îú‚îÄ‚îÄ components/            # React components
‚îÇ   ‚îú‚îÄ‚îÄ dashboard/         # Dashboard widgets
‚îÇ   ‚îî‚îÄ‚îÄ ui/               # shadcn/ui components
‚îú‚îÄ‚îÄ lib/                  # Utilities and services
‚îÇ   ‚îú‚îÄ‚îÄ db.ts            # Database service
‚îÇ   ‚îú‚îÄ‚îÄ metrics.ts       # Metrics calculations
‚îÇ   ‚îú‚îÄ‚îÄ pipedrive.ts     # Pipedrive API service
‚îÇ   ‚îî‚îÄ‚îÄ utils.ts         # Utility functions
‚îî‚îÄ‚îÄ types/               # TypeScript types
    ‚îî‚îÄ‚îÄ index.ts         # Type definitions
```

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- API —Ç–æ–∫–µ–Ω—ã Pipedrive —Ö—Ä–∞–Ω—è—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
- –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∑–∞—â–∏—â–µ–Ω–∞ Bearer —Ç–æ–∫–µ–Ω–æ–º
- –ü—É–±–ª–∏—á–Ω—ã–π –¥–æ—Å—Ç—É–ø –±–µ–∑ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ (MVP)

## üìù –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–õ–æ–≥–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ —Ç–∞–±–ª–∏—Ü–µ `sync_logs`:
- –í—Ä–µ–º—è –Ω–∞—á–∞–ª–∞ –∏ –æ–∫–æ–Ω—á–∞–Ω–∏—è
- –°—Ç–∞—Ç—É—Å (ok/error)
- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

## üêõ –û—Ç–ª–∞–¥–∫–∞

### –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤

```bash
# –õ–æ–∫–∞–ª—å–Ω–æ
npm run dev

# –í Vercel
vercel logs
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —Å–∏–Ω–∫–∞
curl "http://localhost:3000/api/sync/logs"
```

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API

```bash
# –¢–µ—Å—Ç –º–µ—Ç—Ä–∏–∫
curl "http://localhost:3000/api/pm/metrics?from=2025-01-01&to=2025-12-31"

# –¢–µ—Å—Ç –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã—Ö
curl "http://localhost:3000/api/pm/overdue?from=2025-01-01&to=2025-12-31"
```

## üîÆ –ü–ª–∞–Ω—ã —Ä–∞–∑–≤–∏—Ç–∏—è

- [ ] –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –¥—Ä—É–≥–∏—Ö –æ—Ç–¥–µ–ª–æ–≤ (DS, CSM, Finance, Partner, Sales)
- [ ] –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –∏ ACL
- [ ] –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ —Ä–∞—Å–∫–ª–∞–¥–∫–∏
- [ ] –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö (CSV/PNG)
- [ ] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –¥—Ä—É–≥–∏–º–∏ –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º–∏ (CarrotQuest, Gmail, Sheets)
- [ ] –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –ø—Ä–æ—Å—Ä–æ—á–∫–∞—Ö
- [ ] –ú–æ–±–∏–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º:

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –≤ Vercel Dashboard
2. –£–±–µ–¥–∏—Ç–µ—Å—å –≤ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
4. –£–±–µ–¥–∏—Ç–µ—Å—å –≤ –Ω–∞–ª–∏—á–∏–∏ —Ç–æ–∫–µ–Ω–∞ Pipedrive API

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

MIT License
